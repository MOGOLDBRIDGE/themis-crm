<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Themis CRM</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
<script>
var PENDING = null;
(function(){
    var params = new URLSearchParams(window.location.search);
    var data = params.get('addCandidate');
    if(data){
        try { PENDING = JSON.parse(data); } catch(e){}
        window.history.replaceState({},'',window.location.pathname);
    }
})();
</script>
<div id="root">Loading...</div>
<script type="text/babel">
const SUPABASE_URL = 'https://hmmmhtjchhjfwadoqyrb.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhtbW1odGpjaGhqZndhZG9xeXJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3MDkyMDEsImV4cCI6MjA4NTI4NTIwMX0.4uPu94UWKBe6n6qKPvTbNan3Aba57d4VDKwejwsLTQ8';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function App() {
    const [candidates, setCandidates] = React.useState([]);
    const [loading, setLoading] = React.useState(true);
    const [msg, setMsg] = React.useState('');

    React.useEffect(() => {
        loadCandidates();
        if (window.PENDING) {
            addFromLinkedIn(window.PENDING);
            window.PENDING = null;
        }
    }, []);

    const loadCandidates = async () => {
        const { data } = await supabase.from('candidates').select('*').order('created_at', { ascending: false });
        setCandidates(data || []);
        setLoading(false);
    };

    const addFromLinkedIn = async (c) => {
        const { data: existing } = await supabase.from('candidates').select('id').eq('linkedin', c.linkedin);
        if (existing && existing.length > 0) {
            setMsg('Already exists: ' + c.name);
        } else {
            await supabase.from('candidates').insert({ name: c.name, linkedin: c.linkedin, type: 'contract' });
            setMsg('Added: ' + c.name);
            loadCandidates();
        }
        setTimeout(() => setMsg(''), 3000);
    };

    if (loading) return <div style={{padding:'50px',textAlign:'center'}}>Loading...</div>;

    return (
        <div style={{padding:'30px',maxWidth:'1200px',margin:'0 auto'}}>
            {msg && <div style={{position:'fixed',top:'20px',right:'20px',background:'#333',color:'#fff',padding:'15px 25px',borderRadius:'8px'}}>{msg}</div>}
            <h1 style={{marginBottom:'30px'}}>Themis <span style={{color:'#FFDF48'}}>CRM</span></h1>
            <h2>Candidates ({candidates.length})</h2>
            <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(300px,1fr))',gap:'20px',marginTop:'20px'}}>
                {candidates.map(c => (
                    <div key={c.id} style={{background:'#fff',border:'1px solid #e0e0e0',borderRadius:'12px',padding:'20px'}}>
                        <h3>{c.name}</h3>
                        <p style={{color:'#666'}}>{c.email || c.location || ''}</p>
                        {c.linkedin && <a href={c.linkedin} target="_blank">LinkedIn</a>}
                    </div>
                ))}
            </div>
            {candidates.length === 0 && <p style={{color:'#888',marginTop:'20px'}}>No candidates yet. Pull from LinkedIn!</p>}
        </div>
    );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
